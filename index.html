<!-- index.html — FutureScans Web App UI (Tabs + Partial Includes) -->
<!doctype html>
<html>
  <head>
    <base target="_top" />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>FutureScans Alpha</title>

    <style>
      :root{
        --bg:#061432;
        --surface:#0c1f4a;
        --border:rgba(229,238,251,.12);
        --text:#E5EEFB;
        --muted:rgba(229,238,251,.7);
        --muted2:rgba(229,238,251,.5);
        --link:#E5EEFB;
        --accent:#FF7300;
        --accent-soft:rgba(255,115,0,.18);
        --sidebar-bg:#002A7B;
        --sidebar-text:#E5EEFB;
        --sidebar-border:rgba(229,238,251,.18);
      }

      * { box-sizing: border-box; }

      /* ✅ Whole-page scroll */
      html,body{
        height:auto;
        min-height:100%;
        overflow:auto;
      }

      body{
        margin:0;
        font-family: Arial, Helvetica, sans-serif;
        background: radial-gradient(1200px 700px at 15% 10%, rgba(0,42,123,.55), transparent 60%),
                    radial-gradient(900px 600px at 80% 12%, rgba(255,115,0,.18), transparent 55%),
                    var(--bg);
        color:var(--text);

        /* ✅ Allow natural document height growth */
        min-height:100vh;
        display:block;
      }

      /* ===== Sidebar + Tabs ===== */
      .layout{
        min-height:100vh;
        display:flex;
        align-items:stretch;
      }

      .sidebar{
        width: 240px;
        flex: 0 0 240px;
        padding: 18px 16px;
        background: var(--sidebar-bg);
        color: var(--sidebar-text);
        display:flex;
        flex-direction:column;
        gap:18px;
        border-right: 1px solid var(--sidebar-border);
      }

      .brand{
        display:flex;
        align-items:center;
        gap:10px;
      }
      .logoDot{
        width:12px;height:12px;border-radius:999px;
        background: linear-gradient(135deg, var(--accent), rgba(0,42,123,.2));
        box-shadow: 0 0 16px rgba(255,115,0,.35);
      }
      .brand h1{
        margin:0;
        font-size:16px;
        letter-spacing:.2px;
      }
      .brand span{
        display:block;
        font-size:12px;
        color:rgba(229,238,251,.78);
        margin-top:2px;
      }

      .ai-panel{
        margin-top:8px;
        padding:10px;
        border:1px solid rgba(229,238,251,.2);
        border-radius:12px;
        background: rgba(229,238,251,.08);
        display:flex;
        flex-direction:column;
        gap:8px;
        font-size:12px;
      }
      .ai-panel label{
        font-size:11px;
        color:var(--muted);
      }
      .ai-panel select,
      .ai-panel input{
        width:100%;
        padding:6px 8px;
        border-radius:8px;
        border:1px solid rgba(229,238,251,.2);
        background: rgba(6,20,50,.55);
        color:var(--text);
        font-size:12px;
      }
      .ai-panel button{
        padding:7px 10px;
        border-radius:8px;
        border:1px solid rgba(229,238,251,.2);
        background: var(--accent);
        color:#1b1b1b;
        font-size:12px;
        font-weight:600;
        cursor:pointer;
      }
      .ai-status{
        font-size:11px;
        color:var(--muted);
        min-height:14px;
      }

      .tabs{
        display:flex;
        gap:10px;
        flex-direction:column;
      }
      .tab{
        border:1px solid rgba(229,238,251,.24);
        background: rgba(229,238,251,.1);
        color:var(--sidebar-text);
        padding:10px 12px;
        border-radius:12px;
        cursor:pointer;
        font-size:12px;
        text-align:left;
        white-space: nowrap;
      }
      .tab.active{
        border-color: var(--accent);
        background: var(--accent);
        color:#1b1b1b;
        font-weight:600;
      }

      /* ===== Pages container =====
         NOTE: use #app-wrap (not .wrap) to avoid clashing with RawArticles' .wrap class
      */
      .content{
        flex:1 1 auto;
        background: linear-gradient(180deg, rgba(12,31,74,.65), rgba(6,20,50,.9));
      }

      #app-wrap{
        max-width: 1200px;
        width: 100%;
        margin: 0 auto;
        padding: 20px 20px 28px;
        overflow: visible; /* ✅ allow page to grow and scroll */
      }

      .page{
        display:none;
        overflow: visible; /* ✅ let content size naturally */
      }
      .page.active{
        display:block;
      }

      @media (max-width: 980px){
        .layout{ flex-direction:column; }
        .sidebar{
          width:100%;
          flex:0 0 auto;
          border-bottom: 1px solid rgba(229,238,251,.25);
        }
        .tabs{ flex-direction:row; flex-wrap:wrap; }
      }
    </style>
  </head>

  <body>
    <div class="layout">
      <aside class="sidebar">
        <div class="brand">
          <div class="logoDot"></div>
          <div>
            <h1>FutureScans <small>(Alpha)</small></h1>
            <span>Raw • Picks • Rules • Feeds • Report</span>
          </div>
        </div>

        <div class="tabs">
          <button class="tab active" data-page="raw">Raw Articles</button>
          <button class="tab" data-page="picks">Weekly Picks</button>
          <button class="tab" data-page="rules">Theme Rules</button>
          <button class="tab" data-page="feeds">RSS Feeds</button>
          <button class="tab" data-page="report">Report Generator</button>
        </div>

        <div class="ai-panel">
          <div><strong>AI Provider</strong></div>
          <div>
            <label for="ai-provider">Provider</label>
            <select id="ai-provider">
              <option value="gemini">Gemini</option>
              <option value="openai">ChatGPT (OpenAI)</option>
            </select>
          </div>
          <div>
            <label for="ai-model">Model (optional)</label>
            <input id="ai-model" placeholder="e.g. gpt-4o-mini or gemini-1.5-flash" />
          </div>
          <button id="ai-save">Save</button>
          <div class="ai-status" id="ai-status">Loading settings…</div>
        </div>
      </aside>

      <main class="content">
        <div id="app-wrap">
          <div id="page-raw" class="page active">
            <?!= include("RawArticles"); ?>
          </div>

          <div id="page-picks" class="page">
            <?!= include("Picks"); ?>
          </div>

          <div id="page-rules" class="page">
            <?!= include("ThemeRules"); ?>
          </div>

          <div id="page-feeds" class="page">
            <?!= include("RSSFeeds"); ?>
          </div>

          <div id="page-report" class="page">
            <?!= include("ReportPage"); ?>
          </div>
        </div>
      </main>
    </div>

    <script>
      function showPage(pageKey){
        document.querySelectorAll(".page").forEach(p => p.classList.remove("active"));
        document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));

        const page = document.getElementById("page-" + pageKey);
        const tab  = document.querySelector('.tab[data-page="' + pageKey + '"]');

        if (page) page.classList.add("active");
        if (tab) tab.classList.add("active");

        // init hooks
        if (pageKey === "raw"    && typeof window.__init_raw    === "function") window.__init_raw();
        if (pageKey === "picks"  && typeof window.__init_picks  === "function") window.__init_picks();
        if (pageKey === "rules"  && typeof window.__init_rules  === "function") window.__init_rules();
        if (pageKey === "feeds"  && typeof window.__init_feeds  === "function") window.__init_feeds();
        if (pageKey === "report" && typeof window.__init_report === "function") window.__init_report();
      }

      document.querySelectorAll(".tab").forEach(btn => {
        btn.addEventListener("click", () => showPage(btn.dataset.page));
      });

      function setAiStatus(msg) {
        const el = document.getElementById("ai-status");
        if (el) el.textContent = msg;
      }

      function loadAiSettings() {
        if (!google || !google.script || !google.script.run) {
          setAiStatus("Apps Script not available.");
          return;
        }
        google.script.run
          .withSuccessHandler(data => {
            const safe = data || {};
            const provider = String(safe.provider || "gemini").toLowerCase();
            const model = String(safe.model || "");
            const providerEl = document.getElementById("ai-provider");
            const modelEl = document.getElementById("ai-model");
            if (providerEl) providerEl.value = provider;
            if (modelEl) modelEl.value = model;
            setAiStatus("Ready.");
          })
          .withFailureHandler(err => {
            setAiStatus("Failed to load settings.");
            console.error(err);
          })
          .ui_getAiSettings_v1();
      }

      function saveAiSettings() {
        const providerEl = document.getElementById("ai-provider");
        const modelEl = document.getElementById("ai-model");
        const provider = providerEl ? providerEl.value : "gemini";
        const model = modelEl ? modelEl.value : "";
        setAiStatus("Saving…");
        google.script.run
          .withSuccessHandler(() => {
            setAiStatus("Saved.");
          })
          .withFailureHandler(err => {
            setAiStatus("Save failed.");
            console.error(err);
          })
          .ui_setAiSettings_v1(provider, model);
      }

      document.getElementById("ai-save").addEventListener("click", saveAiSettings);

      showPage("raw");
      loadAiSettings();
    </script>
  </body>
</html>
